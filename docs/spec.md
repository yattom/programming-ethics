# 仕様書

プログラマーの倫理アプリの仕様を記述しています。このドキュメントは、アーキテクチャ、アプリ機能、テストなどの一次ソースです。またアプリの機能拡張に応じて随時更新され、最新のスナップショットとしてメンテナンスされます。


## アーキテクチャ要件

- 静的Webアプリとして、利用者のPC上で実行できる。AWSなどに静的Webアプリとしてホスティングできる
- PCブラウザおよびスマートフォンのブラウザで動作する
- Vue.jsで構築する
- オプションとして、利用者のPC上の生成AIを利用できる
  - ollamaを想定しているが実現方法は要検討

### 技術スタックの要件

- pnpm を用いる (npmは禁止)
- node v22 を用いる

### 自動テストの要件

- E2Eテストはplaywrightを用いて実現する
- E2Eテストは、ユースケースを網羅するように作る
  - 細かな仕様はE2Eテストで取り扱わないこと
- マップの実装は、ビューのロジックと切り離したモデルとして実現し、vitestで仕様を細かくテストするユニットテストを書く
- ビューのロジックはユニットテストの対象が意図する
  - 複雑なロジックの場合のみ、別関数やモジュールとして分離して、vitestでユニットテストを書く

## ユースケース

### UC001. プログラマー倫理マップを表示する

1. ユーザーがトップページをアクセスする
2. プログラマー倫理マップを表示する

### UC002. プログラマー倫理マップを詳しく調べる

1. ユーザーがトップページをアクセスする
2. プログラマー倫理マップを表示する
3. 各ノードにマウスオーバーすると、ノードの説明が表示される

### UC003. 自分のマップを作る

1. ユーザーがトップページをアクセスする
2. プログラマー倫理マップを表示する
3. ユーザーがポイント割り振りを開始する
4. Pノードに10ポイントに割り振られる
4a. ユーザーが希望するとさらにポイントをPノードに追加できる
5. ユーザーがノードを選んでポイントを割り振る (増やしたり減らしたりする)
5a. ユーザーはリセットしてすべてのノード (Pノードも含む) のポイントを0にできる
6. (生成AIが利用可能な場合) ユーザーのポイント配分を表現した倫理綱領テキストを表示する


### UC004. 自分のマップを保存したり共有したりする

1. ユーザーがトップページをアクセスする
2. プログラマー倫理マップを表示する
3. ユーザーがポイント割り振りを開始する
4. Pノードに10ポイントに割り振られる
5. ユーザーがノードを選んでポイントを割り振る (増やしたり減らしたりする)
6. ユーザーが自分の名前を入力する
6. URLを保存したりコピーしたりして、現状のマップをユーザーの名前付きで保存できる。他のユーザーに共有することもできる (共有先でもホスト名はlocalhostで同一という前提をおく)

## プログラマー倫理マップ (略称: マップ)

マップは本アプリの根幹である。ユーザーはマップを表示したり、詳しく調べたり、ポイントを配分して自分のマップを作ったりできる。

### 内容

以下のレベルノードが存在し、それぞれ倫理的観点を表現する。なおノードのラベルは純粋に仕様記述上のもので、ユーザーの目に触れてはならない。

- レベルなし
  - P: 個人、組織、あるいは顧客の利益がすべてに優先する
- レベル0
  - N0: 個人、組織、あるいは顧客の利益に優先するものごとがある
- レベル1
  - N1-1: Safety & Reliability (安全性・信頼性)
    - システムが誤作動せず、ユーザーのデータや資産を壊さないこと。
  - N1-2: Agency & Usability (自律性・ユーザビリティ)
    - ユーザーが迷わず、騙されず（ダークパターンなし）、自分の意思で操作できること。
  - N1-3: Privacy & Security (プライバシー・機密性)
    - 預かったデータを漏らさない、盗み見ない。CIAの3要素（機密性・完全性・可用性）。
- レベル2
  - N2-1: Fairness (公平性)
    - その「安全性」が、特定の属性の人（人種、性別）だけでなく、全員に対してバグなく動作すること。バイアスの除去。
  - N2-2: Public Good (公益・持続可能性)
    -  社会全体や環境に対しても害を与えないこと。
  - N2-3: Inclusion & Accessibility (包摂性)
    - 障害を持つ人や高齢者など、多様な身体的条件を持つ人がL1（操作権）を行使できること。
  - N2-4: Human Rights (基本人権)
    - デジタル空間へのアクセスを権利として保障すること。
  - N2-5: Transparency & Explainability (透明性・説明可能性)
    - データをどう使っているか正直に開示する。ブラックボックス化しない。
  - N2-6: Democracy & Rule of Law (民主主義・法の支配)
    - 情報操作や監視によって、社会の意思決定プロセス（選挙など）を歪めないこと。

### 論理的枠組み

- レベル0, 1, 2の3つのレベルがある
- レベル0にはノードが1つ、レベル1はノード3つ、レベル2はノードが6つある
  - N0, N1-1, N1-2, N1-3, N2-1, ... N2-6 と表記する
- ノードはレベル0から1、1から2と進化ラインで接続される
  - 以下の進化ラインが存在する
    - N0->N1-1, N0->N1-2, N0->N1-3
    - N1-1->N2-1, N1-1->N2-2, N1-2->N2-3, N1-2->N2-4, N1-3->N2-5, N1-3->N2-6
- ノードにはポイントを割り振れる
  - あるノードにポイントを割り振るには、割り振りたいポイント以上(同一を含む)のポイントが、下位レベルのノードに割り振ってある必要がある
  - 下位ノードとは、進化ラインで接続されている、1つ前の親ノード
  - ポイントは0以上の整数
  - ポイントの総数は調整事項とし、ここでは定義しない
  - 例:
    - N0=2ポイントのとき、N1-1には2ポイント割り振れるが、3ポイントは割り振れない
    - N1-1=1ポイントのとき、N2-1とN2-2にはそれぞれ1ポイント割り振れるが、2ポイント以上は割り振れない
    - N1-2=1ポイント、N1-3=2ポイントのとき、N2-3, N2-4ノードにはそれぞれ1ポイント割り振れ、N2-5, N2-6ノードにはそれぞれ2ポイント割り振れる
    - N1-1=1ポイントのとき、N2-1に1ポイントも割り振らなくてもよい
    - N0ノードには好きなポイントを割り振れる
    - N0=0ポイントのとき、ほかのノードには1ポイントも割り振れない
  - ポイントを減らすときにもこのルールが適用される。違反する場合には減らせない。ユーザーには適宜わかりやすい反応を返す
- レベルを持たないPノードが存在する
  - Pノードのポイントが、初期のポイント総数を表す
  - P以外のノードにポイントを割り振ると、Pノードのポイントが同じ分減少する
  - Pノードのポイントが0になると、それ以上他のノードにポイントを割り振れない
    - このルールは他のルールに優先する。ノードの親子関係による割り振りが可能でも、Pノードにポイントが残っていなければポイントを増やせない
  - P以外のノードのポイントを減らすと、そのぶんPノードのポイントが増える


### 見た目の表現

- 3つの同心円があり、中心がレベル0、次の領域がレベル1、再外縁がレベル2となる
- 同心円中に各ノードを配置する
  - レベル0は中心に配置する
  - レベル1は12時、4時、8時に配置する
  - レベル2は進化リンクでつながるノードの近くに、11時 1時 3時 5時 7時 9時に配置する
- 同心円の左側には縦長の四角形でPノードを表現する
- ノードに割り振ったポイントは、数字ではなくトークンのようなものを配置した個数で表現する
  - すでにあるトークンをクリックすると減らせるというUIが考えられるが、要検討
  - Pノードのポイントも同様だが、Pノードのトークンは操作しても何も起きない
- ポイントを割り振ると、そのノードおよびノードの周辺の色が濃くなり、ビジュアル的に割り振りの様子が見えるようにする
  - ノードの周辺とは、そのノードが配置された同心円の帯の内部で、ノードがある周囲でかつ他のノードに影響しないところ
  - 例: レベル1の12時に配置したノードの色は、10時～2時くらいの部分に影響する
  - 例: レベル2の5時に配置したノードの色は、4時～6時くらいの部分に影響する
  - 例: レベル0に配置したノードの色は、中央の円全体に影響する
  - ノードの周辺の色はノード近くが濃く、離れるほど薄いグラデーションにする。また隣接するノードの周辺の色は、完全に分離せず、グラデーションの端が混じり合うように調整する
  - Pノードの色は固定で、ポイントに影響されない
- 色がついていないときは白。色はレベルとノードによって異なるものとするが、具体的な色は調整事項とする
  - レベル1はパステル調、レベル2はビビッド調にしたいが要検討
  - レベル1のノードと、進化リンクでつながったレベル2のノードは、近い色合いにしたいが、要検討
- ノードにはラベルは表示しない。内容を暗示するアイコンを表示してもよいが、要検討
- ユーザーがノードを選択すると、そのノードの説明を表示する
  - 選択されたノードを強調表示して、どの説明なのかわかりやすいようにする
  - 説明の表示は、ポップアップにするか、画面上の固定箇所にするか、要検討
- ポイント配布の開始、Pノードへのポイント配布 (追加)、リセットなどの操作要素は、画面設計の中で検討し、適切に実現する

