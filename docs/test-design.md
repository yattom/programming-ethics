# テスト方針

## 方針概要

| テスト種別 | ツール | 対象 |
|-----------|--------|------|
| E2E テスト | playwright | ユースケース (UC) 単位の操作フロー |
| ユニットテスト | vitest | マップモデルのロジック、複雑なビューロジック |

## E2E テスト (playwright)

### 方針

- 各ユースケース (UC001〜UC004) を網羅するシナリオを1つ以上書く
- 細かな仕様 (バリデーションの詳細など) は E2E テストの対象外
- ユーザーの操作と画面の反応を検証する

### テスト一覧 (予定)

| テスト ID | 対応UC | 内容 |
|-----------|--------|------|
| E01 | UC001 | トップページを開くと倫理マップが表示される |
| E02 | UC002 | ノードにマウスオーバーすると説明が表示される |
| E03 | UC003 | ポイントを配布してマップが更新される |
| E04 | UC004 | マップ状態を URL で共有・復元できる |
| E05 | UC001 | ollama接続インジケーターが正しく表示される (接続成功・失敗) |
| E06 | UC003 | マップ変更時に倫理綱領テキストが生成・表示される |

## ユニットテスト (vitest)

### マップモデル (EthicsMap.js)

- ノード構造の定義が正しいこと
- 親子関係 (進化ライン) が正しいこと
- ポイント割り振りルールの検証:
  - 上限 (親ノードのポイント以下) のチェック
  - Pノード総量のチェック
  - ポイントを減らすときのルール (子ノードへの影響)
- 各種メソッドの正常系・異常系

### ビューロジック

- 複雑なロジック (例: 色のグラデーション計算、URL エンコード/デコード) を別関数に切り出した場合のみユニットテストを書く
- シンプルな Vue コンポーネントのロジックはユニットテストの対象外

### AI連携 (ollamaClient.js)

- `fetch` をモックして接続確認・テキスト生成・ストリーミング処理のロジックをユニットテストする
- E2E テスト (E05, E06) では Playwright の `page.route()` で `localhost:11434` へのリクエストをインターセプトし、実際の ollama なしに UI 動作を検証する

## テストしないもの

- CSS スタイルの詳細
- 実際の ollama を使った統合確認 (手動の実機確認で代替する)
- 生成テキストの内容・品質
- 単純な表示のみのコンポーネント
