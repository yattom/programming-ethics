# UI 設計書

## 画面レイアウト

### PC ブラウザ

```
┌──────────────────────────────────────────────────────┐
│  [タイトル]                                           │
├────┬────────────────────────────────┬────────────────┤
│    │                                │                │
│ P  │       倫理マップ (同心円)       │   説明パネル   │
│ノ  │                                │                │
│ー  │                                │                │
│ド  │                                │                │
│    │                                │                │
├────┴────────────────────────────────┴────────────────┤
│              操作エリア (ボタン類)                    │
└──────────────────────────────────────────────────────┘
```

### スマートフォン (縦画面)

マップを画面幅いっぱいに表示する。操作ボタンは画面下部に固定する。説明はボトムシートで表示する。

```
┌──────────────────┐
│  [タイトル]       │
├──────────────────┤
│                  │
│  [マップ全幅]     │
│  (Pノードは       │
│   マップ内左端)   │
│                  │
├──────────────────┤  ← 固定
│  [操作ボタン]     │
└──────────────────┘

ノード選択時 (ボトムシート):
┌──────────────────┐
│  [マップ]         │
╠══════════════════╣
║  [ノード説明]     ║  ← 下から出る
║  [× 閉じる]      ║
╚══════════════════╝
├──────────────────┤  ← 固定
│  [操作ボタン]     │
└──────────────────┘
```

スマートフォンでのPノード配置: PCではマップ左外側に独立して表示するが、スマートフォンでは同心円の左内縁に重ねて小さく配置する。

スマートフォンでの説明表示:
- ノードをタップするとボトムシートが下から現れる
- ボトムシートは画面の約半分の高さ
- 閉じるボタンまたは下スワイプで閉じる
- ルール違反時の理由もボトムシートに表示する

---

## 倫理マップ (同心円)

### 構造

SVG で描画する。3つの同心円を持ち、内から順にレベル0・レベル1・レベル2の帯を形成する。

### ノードの配置

各ノードは同心円上の指定位置に円形アイコンとして配置する。

| ノード | 配置  | 関連するレベル1ノード |
|--------|-------|----------------------|
| N0     | 中心  | —                    |
| N1-1   | 12時  | —                    |
| N1-2   | 4時   | —                    |
| N1-3   | 8時   | —                    |
| N2-1   | 11時  | N1-1                 |
| N2-2   | 1時   | N1-1                 |
| N2-3   | 3時   | N1-2                 |
| N2-4   | 5時   | N1-2                 |
| N2-5   | 7時   | N1-3                 |
| N2-6   | 9時   | N1-3                 |

### ノードの外観

- 小さな円形のアイコン
- ノードのラベル (N0, N1-1 など) はユーザーに表示しない
- ホバー時: カーソルが変化してクリック可能であることを示す
- 選択時: 枠線または輝きで強調表示
- 配布モード外: クリック不可であることをカーソルで示す

### トークン表示

- ノードに割り振ったポイントは、ノードアイコンの周囲に小さなドット (トークン) を並べて個数で表現する
- トークンの最大表示数は視覚的に収まる範囲で上限を設ける (多い場合は数字で補完、要検討)

### 色の表現

- ポイントが増えると、そのノードが位置する同心円の帯 (弧状の領域) が色づく
- 色はポイント数に比例して濃くなる
- 隣接するノードの色はグラデーションで混じり合い、完全に分離しない
- ポイントが0のとき: 白 (無彩色)
- レベル1: パステル系の色
- レベル2: ビビッド系の色 (レベル1と対応するノードは近い色相)
- 具体的な色は実装時に調整する

### 色の影響範囲

| ノード     | 影響する弧の範囲   |
|------------|-------------------|
| N0         | 中央の円全体       |
| レベル1    | ±約2時間分の帯     |
| レベル2    | ±約1時間分の帯     |

---

## Pノード

- マップの左側に縦長の四角形で表示する
- 保有ポイントをトークンで表示する (クリックしても何も起きない)
- 色は固定 (ポイントに影響されない)
- 配布モード外でも常に表示する

---

## ノードの選択と説明表示

- ノードをクリック/タップ → そのノードを選択し、説明を表示する
- 配布モード外・配布モード中を問わず同じ動作

### PCブラウザ

- 説明パネル (画面右側の固定エリア) に表示する
- 選択中は他ノードにホバーしても説明は切り替わらない
- 選択中のノードがない場合: アプリの簡単な説明文を表示する

### スマートフォン

- ボトムシートに表示する (下から出現)
- 閉じるボタンまたは下スワイプで閉じる

---

## ポイント操作 (配布モード中のみ)

ノードを選択すると、そのノードの近くに **[+] ボタン** が出現する。

### ポイントの増加

- 選択中ノードの [+] ボタンをクリック/タップ → そのノードのポイントを1増やす
- ルール違反 (親のポイントを超える、Pが不足) の場合:
  - [+] ボタンを小さく振動させる (shake アニメーション)
  - 説明パネル/ボトムシートに違反理由を表示する

### ポイントの減少

- ノードに表示されているトークンをクリック/タップ → そのノードのポイントを1減らす
- ルール違反 (子ノードが現在値を超えるため減らせない) の場合:
  - トークンを小さく振動させる (shake アニメーション)
  - 説明パネル/ボトムシートに違反理由を表示する

---

## 操作エリア (ボタン類)

| ボタン         | 表示条件       | 動作                                        |
|----------------|---------------|---------------------------------------------|
| 配布開始       | 配布モード外   | Pノードに10ポイント付与、配布モードに切り替え  |
| ポイント追加   | 配布モード中   | Pノードに5ポイント追加する                   |
| リセット       | 配布モード中   | 全ノードのポイントを0にする。確認ダイアログを表示する |

---

## URL 共有・保存 (UC004)

- 操作エリアにユーザー名入力フィールドを配置する
- 「URLをコピー」ボタンで現在のマップ状態 (ユーザー名 + 全ノードのポイント) を URL クエリパラメータに encode してクリップボードにコピーする
- コピー完了時にボタンのラベルを一時的に「コピーしました！」に変えてフィードバックする
- 共有URLを開いたとき: 保存されたポイント配分を復元した状態で配布モードになる

---

## 初期状態 (配布開始前)

- マップは表示されているがポイントはすべて0
- 全ノードのトークンは空
- 「配布開始」ボタンのみ有効
- ノードのホバーと説明表示は操作可能 (UC002)
